/*! 
 * angular-advanced-searchbox v2.0.0-dev
 * https://github.com/dnauck/angular-advanced-searchbox
 * Copyright (c) 2015 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */
!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",defaultparams:"=",enter:"=",placeholder:"@"},replace:!0,templateUrl:"angular-advanced-searchbox.html",controller:["$scope","$attrs","$element","$timeout","$filter",function(a,b,c,d,e){function f(){angular.forEach(a.model,function(b,c){if("query"===c)a.searchQuery=b;else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0];void 0!==d&&a.addSearchParam(d,b,!1)}})}function g(b,c,f){i&&d.cancel(i),j=e("filter")(j,function(a){return a.key!==c}),j.push({command:b,key:c,value:f}),i=d(function(){angular.forEach(j,function(b){"delete"===b.command?delete a.model[b.key]:a.model[b.key]=b.value}),j.length=0},500)}function h(a){if(!a)return 0;if("number"==typeof a.selectionStart)return"backward"===a.selectionDirection?a.selectionStart:a.selectionEnd;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}return 0}a.placeholder=a.placeholder||"Search ...",a.searchParams=[],a.searchQuery="",a.setSearchFocus=!1,a.Enter=a.enter;var i,j=[];a.defaultparams?a.defaultparams.query||(a.defaultparams.query=""):a.defaultparams={},a.model=angular.copy(a.defaultparams),a.$watch("defaultparams",function(){a.model=angular.copy(a.defaultparams)}),a.$watch("model",function(b,c){angular.equals(b,c)||(angular.forEach(a.model,function(b,c){if("query"===c&&a.searchQuery!==b)a.searchQuery=b;else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0],f=e("filter")(a.searchParams,function(a){return a.key===c})[0];void 0!==d&&(void 0===f?a.addSearchParam(d,b,!1):f.value!==b&&(f.value=b))}}),angular.forEach(a.searchParams,function(b,c){if(!a.model.hasOwnProperty(b.key)){var d=a.searchParams.map(function(a){return a.key}).indexOf(b.key);a.removeSearchParam(d)}}))},!0),a.isDefault=function(){return angular.equals(a.defaultparams,a.model)},a.idxOfList=function(a,b){var c=a.indexOf(b);if(c>=0)return c;c=0;for(var d in a){if(angular.equals(b,a[d]))return c;c+=1}return-1},a.searchParamValueChanged=function(a){g("change",a.key,a.value)},a.searchQueryChanged=function(a){g("change","query",a)},a.enterEditMode=function(b){if(void 0!==b){var c=a.searchParams[b];c.editMode=!0,a.focus=!0}},a.leaveEditMode=function(b){if(void 0!==b){var c=a.searchParams[b];c.editMode=!1,c.value||a.removeSearchParam(b)}},a.typeaheadOnSelect=function(b,c,d){a.addSearchParam(b),a.searchQuery="",g("delete","query")},a.isUnsedParameter=function(b,c){return 0===e("filter")(a.searchParams,function(a){return a.key===b.key}).length},a.addSearchParam=function(b,c,e){void 0===e&&(e=!0),a.isUnsedParameter(b)&&(a.searchParams.push({key:b.key,name:b.name,placeholder:b.placeholder,type:b.type,options:b.options,required:b.required,value:c||"",editMode:e}),void 0===c&&d(function(){a.focus=!0}),g("add",b.key,c))},a.removeSearchParam=function(b){if(void 0!==b){var c=a.searchParams[b];c.required||(a.searchParams.splice(b,1),g("delete",c.key))}},a.removeAll=function(){a.searchParams.length=0,a.searchQuery="",a.model={},a.model=angular.copy(a.defaultparams),a.focus=!1},a.editPrevious=function(b){void 0!==b&&a.leaveEditMode(b),b>0?a.enterEditMode(b-1):a.searchParams.length>0&&a.enterEditMode(a.searchParams.length-1)},a.editNext=function(b){void 0!==b&&(a.leaveEditMode(b),b<a.searchParams.length-1?a.enterEditMode(b+1):a.setSearchFocus=!0)},a.keydown=function(b,c){var d=[8,9,13,37,39];if(-1!==d.indexOf(b.which)){var e,f;try{e=!1,f=h(b.target)}catch(g){e=!0}8==b.which?(e||0===f)&&(b.preventDefault(),0===c?a.editNext(c):a.editPrevious(c)):9==b.which?b.shiftKey?(b.preventDefault(),a.editPrevious(c)):(b.preventDefault(),a.editNext(c)):13==b.which?a.editNext(c):37==b.which?0===f&&a.editPrevious(c):39==b.which&&f===b.target.value.length&&a.editNext(c)}},void 0===a.model?a.model={}:f()}]}}).directive("nitSetFocus",["$timeout","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.nitSetFocus);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){c.$apply(f.assign(c,!1))})}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(a,b,c){function d(){f.text(b.val()||b.attr("placeholder")),b.css("width",f.outerWidth()+10)}var e=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),f=angular.element('<span style="white-space:pre;"></span>'),g="none"===b.css("maxWidth")?b.parent().innerWidth():b.css("maxWidth");b.css("maxWidth",g),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(a){f.css(a,b.css(a))}),angular.element("body").append(e.append(f)),d(),a.model?a.$watch("model",function(){d()}):b.on("keypress keyup keydown focus input propertychange change",function(){d()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(a){"use strict";a.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setSearchFocus = true : null"><form ng-submit=Enter()><span ng-show="isDefault() && searchQuery.length === 0" class="search-icon fa fa-search"></span> <a ng-href="" ng-hide="isDefault() && searchQuery.length === 0" ng-click=removeAll() role=button><span class="remove-all-icon fa fa-refresh"></span></a><div><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button ng-hide=searchParam.required><span class="remove fa fa-trash"></span></a> <a ng-href="" ng-click="" role=button ng-show=searchParam.required><span class=remove></span></a><div class=key>{{searchParam.name}}:</div><div class=value ng-if="searchParam.type != \'list\'"><span ng-if=!searchParam.editMode ng-click=enterEditMode($index)>&nbsp;{{(searchParam.type == \'date\') ? (searchParam.value| date: "yyyy-MM-dd"): searchParam.value}}</span> <input name=value type={{searchParam.type}} ng-model-options="{ timezone: \'+0000\' }" nit-set-focus=searchParam.editMode ng-keydown="keydown($event, $index)" ng-blur=leaveEditMode($index) ng-if=searchParam.editMode ng-change=searchParamValueChanged(searchParam) ng-model=searchParam.value placeholder="{{searchParam.placeholder}}"></div><div class=value ng-if="searchParam.type == \'list\'"><span ng-if=!searchParam.editMode ng-click=enterEditMode($index)>&nbsp;{{searchParam.value.cname || searchParam.value.name}}</span><select nit-set-focus=searchParam.editMode ng-keydown="keydown($event, $index)" ng-blur=leaveEditMode($index) ng-if=searchParam.editMode ng-change=searchParamValueChanged(searchParam) ng-model=searchParam.value ng-options="m.cname || m.name for m in searchParam.options" ng-init="searchParam.value = searchParam.options[idxOfList(searchParam.options, searchParam.value)]"></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input nit-set-focus=setSearchFocus ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" typeahead-on-select="typeaheadOnSelect($item, $model, $label)" typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue} | limitTo:8" ng-change=searchQueryChanged(searchQuery) ng-model="searchQuery"></div><div class=search-parameter-suggestions ng-show="(parameters | filter:isUnsedParameter).length && focus"><span class=title>Parameter Suggestions:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter | limitTo:8" ng-mousedown=addSearchParam(param)>{{param.name}}</span></div></form></div>'),a.put("test.html",'<!DOCTYPE html><html ng-app=app lang=en id=top><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A directive for AngularJS providing a advanced visual search box"><meta name=author content="Gator Liu"><link rel=icon href=favicon.ico><title>Another Angular Advanced Searchbox</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css><link rel=stylesheet href=angular-advanced-searchbox.css><script src=http://code.jquery.com/jquery-2.1.1.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js></script><script src=https://rawgit.com/angular-ui/bootstrap/gh-pages/ui-bootstrap-tpls-0.13.0.min.js></script><script src=angular-advanced-searchbox.js></script><script>var app = angular.module(\'app\', [\'ui.bootstrap\', \'angular-advanced-searchbox\']);\n\n\n      app.controller(\'DemoController\', function($scope, $filter) {\n        $scope.availableSearchParams = [\n          { key: "name", name: "Name", placeholder: "Name..." },\n          { key: "city", name: "City", type:"list", options: [{id:\'ny\', name:\'New York\'}, {id:\'tp\', name:\'Taipei\'}], required:true },\n          { key: "emailAddress", name: "E-Mail", placeholder: "E-Mail..." },\n          { key: "job", name: "Job", placeholder: "Job..." },\n          { key: "sd", name: "Start Date", placeholder: "sds", type:"date", required:true },\n          { key: "ed", name: "End Date", placeholder: "eds", type:"date", required:true }\n        ];\n          $scope.defaultParams = {\n            name: "Max M.",\n            city: {id:\'tp\', name:\'Taipei\'},\n            sd: new Date($filter("date")(Date.now(), \'yyyy-MM-dd\'))\n            };\n          $scope.search = function() {\n            alert("do search....:\\n  search_key = " + JSON.stringify($scope.searchParams)  );\n          };\n\n        $scope.addPredefinedNameSearchParam = function(){\n          $scope.searchParams.name = \'Max Mustermann\';\n        };\n\n        $scope.loadPredefinedSearchParamSet = function(){\n          $scope.defaultParams = {\n            name: "Max M.",\n            city: {id:\'tp\', name:\'Taipei\'},\n            sd: new Date($filter("date")(Date.now(), \'yyyy-MM-dd\'))\n          };\n        };\n      \n      });</script></head><body><nav class="navbar navbar-inverse navbar-fixed-top" role=navigation><div class=container><div class=navbar-header><a class=navbar-brand href=#top>Another Angular Advanced Searchbox</a></div><div id=navbar class="navbar-collapse collapse"></div></div></nav><div class=container ng-controller=DemoController><div class=jumbotron><h1>Another Angular Advanced Searchbox</h1><p>A directive for AngularJS providing a advanced visual search box.<br><small>Forked from <a href=https://github.com/dnauck/angular-advanced-searchbox target=_blank>Dnauck\'s project</a> and added some features.</small></p><form target=paypal action=https://www.paypal.com/cgi-bin/webscr method=post name=donateform><a class="btn btn-primary btn-lg" href=https://github.com/gatorliu/angular-advanced-searchbox/archive/master.zip role=button><span class="fa fa-download"></span> Download</a> <a class="btn btn-default btn-lg" href=https://github.com/gatorliu/angular-advanced-searchbox role=button><span class="fa fa-github"></span> Github</a> <input type=hidden name=cmd value=_s-xclick> <input type=hidden name=hosted_button_id value=5R3T7PLQSAY9E> <a class="btn btn-default btn-lg" href="javascript: document.donateform.submit()" role=button><span class="fa fa-paypal"></span> Donate</a> <img alt="" border=0 src=https://www.paypalobjects.com/en_US/i/scr/pixel.gif width=1 height=1></form></div><div class=row><div class=col-sm-12><h2>Demo</h2><p>Click on a suggested search parameter or use autocompletion feature and press \'Enter\' to add new search parameter to your query. Use \'TAB\', \'SHIFT+TAB\', \'LEFT\', \'RIGHT\' or \'BACKSPACE\' to navigate between search parameters. Using \'Enter\' to Submit.</p><nit-advanced-searchbox ng-model=searchParams parameters=availableSearchParams defaultparams=defaultParams placeholder=Search... enter=search></nit-advanced-searchbox><p><strong>Output:</strong><pre><code>{{searchParams}}</code></pre>The output model could be directly used as params object for Angular\'s $http API.</p><p><strong>Test:</strong> loading predefined search parameters via code:<br><button class="btn btn-info" ng-click=addPredefinedNameSearchParam()>Add predefined "Name" Search Parameter</button> <button class="btn btn-info" ng-click=loadPredefinedSearchParamSet()>Load predefined Search Parameter Set</button></p></div><div class=col-sm-12><h2>Getting started</h2><p>Define the available search parameters in your controller\'s code:</p><p><pre><code>\n$scope.availableSearchParams = [\n   { key: "name", name: "Name", placeholder: "Name..." },\n   { key: "city", name: "City", type:"list", options: [{id:\'ny\', name:\'New York\'}, {id:\'tp\', name:\'Taipei\'}], required:true },\n   { key: "emailAddress", name: "E-Mail", placeholder: "E-Mail..." },\n   { key: "job", name: "Job", placeholder: "Job..." },\n   { key: "sd", name: "Start Date", placeholder: "sds", type:"date", required:true },\n   { key: "ed", name: "End Date", placeholder: "eds", type:"date", required:true }\n];\n $scope.defaultParams = {\n   name: "Max M.",\n   city: {id:\'tp\', name:\'Taipei\'},\n   sd: new Date($filter("date")(Date.now(), \'yyyy-MM-dd\'))\n   };\n $scope.search = function() {\n   alert("do search....:\\n  search_key = " + JSON.stringify($scope.searchParams)  );\n }:\n            </code></pre></p><p>Add the following AngularJS directive to your HTML:</p><p><pre><code>&#60;nit-advanced-searchbox\n            ng-model="searchParams"\n            parameters="availableSearchParams"\n            defaultparams="defaultParams"\n            placeholder="Search..." \n            enter="search"\n            &#62;\n&#60;/nit-advanced-searchbox&#62; </code></pre></p><p><a class="btn btn-primary" href=https://github.com/gatorliu/angular-advanced-searchbox/blob/master/README.md role=button>View Readme &raquo;</a></p></div></div><hr><footer><p>&copy; Gator Liu 2015</p></footer></div></body></html>')}]);